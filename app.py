# app.py - The Streamlit User Interface for KrishiMitra

import streamlit as st
import requests
import pandas as pd
from io import BytesIO

# --- Page Configuration ---
st.set_page_config(
    page_title="KrishiMitra - AI Farming Assistant",
    page_icon="ЁЯМ╛",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- Backend API URL ---
BACKEND_URL = "http://127.0.0.1:8000"

# --- 1. BHASHABUDDY: TRANSLATION DICTIONARY ---
translations = {
    "en": {
        "header": "KrishiMitra",
        "subheader": "Your AI-powered assistant for smart farming decisions in India.",
        "bhashabuddy_header": "BhashaBuddy",
        "choose_language": "Choose Language:",
        "sidebar_info": "Select a language for a fully translated experience.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П Expert Diagnosis",
        "tab_mandi": "ЁЯУИ Mandi Prices",
        "tab_health": "ЁЯМ┐ Crop Health",
        "tab_schemes": "ЁЯУЬ Govt. Schemes",
        "tab_recommendations": "ЁЯМН Crop Recommendations",
        "expert_header": "ЁЯза Expert Diagnosis & Productivity Plan",
        "expert_desc": "Describe your crop's situation to get a detailed action plan from our AI agronomist.",
        "enter_crop": "1. Enter Your Crop:",
        "crop_stage": "2. Select Crop Stage:",
        "problem_desc": "3. Describe the Problem (e.g., 'yellow spots on lower leaves'):",
        "goal": "4. What is your primary goal?",
        "get_plan_button": "Generate Expert Plan",
        "ai_spinner": "ЁЯдЦ KrishiNet AI is analyzing your situation...",
        "expert_plan_header": "Your Custom Action Plan:",
        "listen_plan": "Listen to this Plan",
        "audio_spinner": "Generating audio...",
        "audio_error": "Sorry, could not generate audio.",
        "chatbot_header": "ЁЯТм Quick Chat",
        "chat_input_placeholder": "Ask a quick question...",
    },
    "hi": {
        "header": "рдХреГрд╖рд┐ рдорд┐рддреНрд░",
        "subheader": "рднрд╛рд░рдд рдореЗрдВ рд╕реНрдорд╛рд░реНрдЯ рдЦреЗрддреА рдХреЗ рдлреИрд╕рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдкрдХрд╛ рдПрдЖрдИ-рд╕рдВрдЪрд╛рд▓рд┐рдд рд╕рд╣рд╛рдпрдХред",
        "bhashabuddy_header": "рднрд╛рд╖рд╛рдмрдбреА",
        "choose_language": "рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ:",
        "sidebar_info": "рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдЕрдиреБрднрд╡ рдХреЗ рд▓рд┐рдП рдПрдХ рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВред",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдирд┐рджрд╛рди",
        "tab_mandi": "ЁЯУИ рдордВрдбреА рдХреАрдорддреЗрдВ",
        "tab_health": "ЁЯМ┐ рдлрд╕рд▓ рд╕реНрд╡рд╛рд╕реНрдереНрдп",
        "tab_schemes": "ЁЯУЬ рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ",
        "tab_recommendations": "ЁЯМН рдлрд╕рд▓ рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ",
        "expert_header": "ЁЯза рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдирд┐рджрд╛рди рдФрд░ рдЙрддреНрдкрд╛рджрдХрддрд╛ рдпреЛрдЬрдирд╛",
        "expert_desc": "рд╣рдорд╛рд░реЗ рдПрдЖрдИ рдХреГрд╖рд┐ рд╡рд┐рдЬреНрдЮрд╛рдиреА рд╕реЗ рд╡рд┐рд╕реНрддреГрдд рдХрд╛рд░реНрдп рдпреЛрдЬрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдлрд╕рд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реЗрдВред",
        "enter_crop": "1. рдЕрдкрдиреА рдлрд╕рд▓ рджрд░реНрдЬ рдХрд░реЗрдВ:",
        "crop_stage": "2. рдлрд╕рд▓ рдХреА рдЕрд╡рд╕реНрдерд╛ рдЪреБрдиреЗрдВ:",
        "problem_desc": "3. рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реЗрдВ (рдЬреИрд╕реЗ, 'рдирд┐рдЪрд▓реА рдкрддреНрддрд┐рдпреЛрдВ рдкрд░ рдкреАрд▓реЗ рдзрдмреНрдмреЗ'):",
        "goal": "4. рдЖрдкрдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рд▓рдХреНрд╖реНрдп рдХреНрдпрд╛ рд╣реИ?",
        "get_plan_button": "рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдпреЛрдЬрдирд╛ рдмрдирд╛рдПрдВ",
        "ai_spinner": "ЁЯдЦ рдХреГрд╖рд┐рдиреЗрддреНрд░ рдПрдЖрдИ рдЖрдкрдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░ рд░рд╣рд╛ рд╣реИ...",
        "expert_plan_header": "рдЖрдкрдХреА рдХрд╕реНрдЯрдо рдХрд╛рд░реНрдп рдпреЛрдЬрдирд╛:",
        "listen_plan": "рдЗрд╕ рдпреЛрдЬрдирд╛ рдХреЛ рд╕реБрдиреЗрдВ",
        "audio_spinner": "рдСрдбрд┐рдпреЛ рдмрдирд╛ рд░рд╣рд╛ рд╣реИ...",
        "audio_error": "рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдСрдбрд┐рдпреЛ рдирд╣реАрдВ рдмрди рд╕рдХрд╛ред",
        "chatbot_header": "ЁЯТм рддреНрд╡рд░рд┐рдд рдЪреИрдЯ",
        "chat_input_placeholder": "рдПрдХ рддреНрд╡рд░рд┐рдд рдкреНрд░рд╢реНрди рдкреВрдЫреЗрдВ...",
    },
    "mr": {
        "header": "рдХреГрд╖реАрдорд┐рддреНрд░",
        "subheader": "рднрд╛рд░рддрд╛рддреАрд▓ рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрддреАрдЪреНрдпрд╛ рдирд┐рд░реНрдгрдпрд╛рдВрд╕рд╛рдареА рддреБрдордЪрд╛ рдПрдЖрдп-рд╢рдХреНрддреА рдЕрд╕рд▓реЗрд▓рд╛ рд╕рд╣рд╛рдпреНрдпрдХ.",
        "bhashabuddy_header": "рднрд╛рд╖рд╛рдмрдбреА",
        "choose_language": "рднрд╛рд╖рд╛ рдирд┐рд╡рдбрд╛:",
        "sidebar_info": "рдкреВрд░реНрдгрдкрдгреЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдЕрдиреБрднрд╡рд╛рд╕рд╛рдареА рдПрдХ рднрд╛рд╖рд╛ рдирд┐рд╡рдбрд╛.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдирд┐рджрд╛рди",
        "tab_mandi": "ЁЯУИ рдордВрдбреА рднрд╛рд╡",
        "tab_health": "ЁЯМ┐ рдкреАрдХ рдЖрд░реЛрдЧреНрдп",
        "tab_schemes": "ЁЯУЬ рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛",
        "tab_recommendations": "ЁЯМН рдкреАрдХ рд╢рд┐рдлрд╛рд░рд╕реА",
        "expert_header": "ЁЯза рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдирд┐рджрд╛рди рдЖрдгрд┐ рдЙрддреНрдкрд╛рджрдХрддрд╛ рдпреЛрдЬрдирд╛",
        "expert_desc": "рдЖрдордЪреНрдпрд╛ рдПрдЖрдп рдХреГрд╖реАрд╢рд╛рд╕реНрддреНрд░рдЬреНрдЮрд╛рдХрдбреВрди рддрдкрд╢реАрд▓рд╡рд╛рд░ рдХреГрддреА рдпреЛрдЬрдирд╛ рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА рддреБрдордЪреНрдпрд╛ рдкрд┐рдХрд╛рдЪреА рдкрд░рд┐рд╕реНрдерд┐рддреА рд╕рд╛рдВрдЧрд╛.",
        "enter_crop": "рез. рддреБрдордЪреЗ рдкреАрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛:",
        "crop_stage": "реи. рдкрд┐рдХрд╛рдЪрд╛ рдЯрдкреНрдкрд╛ рдирд┐рд╡рдбрд╛:",
        "problem_desc": "рей. рд╕рдорд╕реНрдпреЗрдЪреЗ рд╡рд░реНрдгрди рдХрд░рд╛ (рдЙрджрд╛. 'рдЦрд╛рд▓рдЪреНрдпрд╛ рдкрд╛рдирд╛рдВрд╡рд░ рдкрд┐рд╡рд│реЗ рдбрд╛рдЧ'):",
        "goal": "рек. рддреБрдордЪреЗ рдкреНрд░рд╛рдердорд┐рдХ рдзреНрдпреЗрдп рдХрд╛рдп рдЖрд╣реЗ?",
        "get_plan_button": "рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдпреЛрдЬрдирд╛ рддрдпрд╛рд░ рдХрд░рд╛",
        "ai_spinner": "ЁЯдЦ рдХреГрд╖реАрдиреЗрдЯ рдПрдЖрдп рддреБрдордЪреНрдпрд╛ рдкрд░рд┐рд╕реНрдерд┐рддреАрдЪреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдд рдЖрд╣реЗ...",
        "expert_plan_header": "рддреБрдордЪреА рд╕рд╛рдиреБрдХреВрд▓ рдХреГрддреА рдпреЛрдЬрдирд╛:",
        "listen_plan": "рд╣реА рдпреЛрдЬрдирд╛ рдРрдХрд╛",
        "audio_spinner": "рдСрдбрд┐рдУ рддрдпрд╛рд░ рд╣реЛрдд рдЖрд╣реЗ...",
        "audio_error": "рдХреНрд╖рдорд╕реНрд╡, рдСрдбрд┐рдУ рддрдпрд╛рд░ рдХрд░рддрд╛ рдЖрд▓рд╛ рдирд╛рд╣реА.",
        "chatbot_header": "ЁЯТм рддреНрд╡рд░рд┐рдд рдЧрдкреНрдкрд╛",
        "chat_input_placeholder": "рдПрдХ рддреНрд╡рд░рд┐рдд рдкреНрд░рд╢реНрди рд╡рд┐рдЪрд╛рд░рд╛...",
    },
    "gu": {
        "header": "ркХрлГрк╖рк┐ркорк┐ркдрлНрк░",
        "subheader": "ркнрк╛рк░ркдркорк╛ркВ рк╕рлНркорк╛рк░рлНркЯ ркЦрлЗркдрлАркирк╛ ркирк┐рк░рлНркгркпрлЛ ркорк╛ркЯрлЗ ркдркорк╛рк░рк╛ ркПркЖркИ-рк╕ркВркЪрк╛рк▓рк┐ркд рк╕рк╣рк╛ркпркХ.",
        "bhashabuddy_header": "ркнрк╛рк╖рк╛ркмркбрлА",
        "choose_language": "ркнрк╛рк╖рк╛ рккрк╕ркВркж ркХрк░рлЛ:",
        "sidebar_info": "рк╕ркВрккрлВрк░рлНркг ркЕркирлБрк╡рк╛ркжрк┐ркд ркЕркирлБркнрк╡ ркорк╛ркЯрлЗ ркнрк╛рк╖рк╛ рккрк╕ркВркж ркХрк░рлЛ.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П ркирк┐рк╖рлНркгрк╛ркд ркирк┐ркжрк╛рки",
        "tab_mandi": "ЁЯУИ ркоркВркбрлАркирк╛ ркнрк╛рк╡",
        "tab_health": "ЁЯМ┐ рккрк╛ркХркирлБркВ ркЖрк░рлЛркЧрлНркп",
        "tab_schemes": "ЁЯУЬ рк╕рк░ркХрк╛рк░рлА ркпрлЛркЬркирк╛ркУ",
        "tab_recommendations": "ЁЯМН рккрк╛ркХркирлА ркнрк▓рк╛ркоркгрлЛ",
        "expert_header": "ЁЯза ркирк┐рк╖рлНркгрк╛ркд ркирк┐ркжрк╛рки ркЕркирлЗ ркЙркдрлНрккрк╛ркжркХркдрк╛ ркпрлЛркЬркирк╛",
        "expert_desc": "ркЕркорк╛рк░рк╛ ркПркЖркИ ркХрлГрк╖рк┐рк╡рк┐ркЬрлНркЮрк╛ркирлА рккрк╛рк╕рлЗркерлА рк╡рк┐ркЧркдрк╡рк╛рк░ ркХрк╛рк░рлНркп ркпрлЛркЬркирк╛ ркорлЗрк│рк╡рк╡рк╛ ркорк╛ркЯрлЗ ркдркорк╛рк░рк╛ рккрк╛ркХркирлА рккрк░рк┐рк╕рлНркерк┐ркдрк┐ркирлБркВ рк╡рк░рлНркгрки ркХрк░рлЛ.",
        "enter_crop": "рлз. ркдркорк╛рк░рлЛ рккрк╛ркХ ркжрк╛ркЦрк▓ ркХрк░рлЛ:",
        "crop_stage": "рли. рккрк╛ркХркирлЛ ркдркмркХрлНркХрлЛ рккрк╕ркВркж ркХрк░рлЛ:",
        "problem_desc": "рлй. рк╕ркорк╕рлНркпрк╛ркирлБркВ рк╡рк░рлНркгрки ркХрк░рлЛ (ркжрк╛.ркд., 'ркирлАркЪрк▓рк╛ рккрк╛ркВркжркбрк╛ рккрк░ рккрлАрк│рк╛ ркбрк╛ркШ'):",
        "goal": "рлк. ркдркорк╛рк░рлБркВ рккрлНрк░рк╛ркеркорк┐ркХ рк▓ркХрлНрк╖рлНркп рк╢рлБркВ ркЫрлЗ?",
        "get_plan_button": "ркирк┐рк╖рлНркгрк╛ркд ркпрлЛркЬркирк╛ ркмркирк╛рк╡рлЛ",
        "ai_spinner": "ЁЯдЦ ркХрлГрк╖рк┐ркирлЗркЯ ркПркЖркИ ркдркорк╛рк░рлА рккрк░рк┐рк╕рлНркерк┐ркдрк┐ркирлБркВ рк╡рк┐рк╢рлНрк▓рлЗрк╖ркг ркХрк░рлА рк░рк╣рлНркпрлБркВ ркЫрлЗ...",
        "expert_plan_header": "ркдркорк╛рк░рлА ркХрк╕рлНркЯрко ркХрк╛рк░рлНркп ркпрлЛркЬркирк╛:",
        "listen_plan": "ркЖ ркпрлЛркЬркирк╛ рк╕рк╛ркВркнрк│рлЛ",
        "audio_spinner": "ркУркбрк┐ркпрлЛ ркЬркирк░рлЗркЯ ркХрк░рлА рк░рк╣рлНркпрлБркВ ркЫрлЗ...",
        "audio_error": "ркорк╛ркл ркХрк░рк╢рлЛ, ркУркбрк┐ркпрлЛ ркЬркирк░рлЗркЯ ркХрк░рлА рк╢ркХрк╛ркпрлЛ ркиркерлА.",
        "chatbot_header": "ЁЯТм ркЭркбрккрлА ркЪрлЗркЯ",
        "chat_input_placeholder": "ркПркХ ркЭркбрккрлА рккрлНрк░рк╢рлНрки рккрлВркЫрлЛ...",
    },
    "bn": {
        "header": "ржХрзГрж╖рж┐ржорж┐рждрзНрж░",
        "subheader": "ржнрж╛рж░рждрзЗ рж╕рзНржорж╛рж░рзНржЯ ржХрзГрж╖рж┐ рж╕рж┐ржжрзНржзрж╛ржирзНрждрзЗрж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржПржЖржЗ-ржЪрж╛рж▓рж┐ржд рж╕рж╣ржХрж╛рж░рзАред",
        "bhashabuddy_header": "ржнрж╛рж╖рж╛рж╕рж╛ржерзА",
        "choose_language": "ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:",
        "sidebar_info": "ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржЕржирзВржжрж┐ржд ржЕржнрж┐ржЬрзНржЮрждрж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржиред",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П ржмрж┐рж╢рзЗрж╖ржЬрзНржЮ ржирж┐рж░рзНржгржпрж╝",
        "tab_mandi": "ЁЯУИ ржоржирзНржбрж┐ ржжрж░",
        "tab_health": "ЁЯМ┐ ржлрж╕рж▓ рж╕рзНржмрж╛рж╕рзНржерзНржп",
        "tab_schemes": "ЁЯУЬ рж╕рж░ржХрж╛рж░рж┐ ржкрзНрж░ржХрж▓рзНржк",
        "tab_recommendations": "ЁЯМН ржлрж╕рж▓ рж╕рзБржкрж╛рж░рж┐рж╢",
        "expert_header": "ЁЯза ржмрж┐рж╢рзЗрж╖ржЬрзНржЮ ржирж┐рж░рзНржгржпрж╝ ржУ ржЙрзОржкрж╛ржжржирж╢рзАрж▓рждрж╛ ржкрж░рж┐ржХрж▓рзНржкржирж╛",
        "expert_desc": "ржЖржорж╛ржжрзЗрж░ ржПржЖржЗ ржХрзГрж╖рж┐ржмрж┐ржжрзЗрж░ ржХрж╛ржЫ ржерзЗржХрзЗ ржПржХржЯрж┐ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржХрж░рзНржо ржкрж░рж┐ржХрж▓рзНржкржирж╛ ржкрзЗрждрзЗ ржЖржкржирж╛рж░ ржлрж╕рж▓рзЗрж░ ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржмрж░рзНржгржирж╛ ржХрж░рзБржиред",
        "enter_crop": "рзз. ржЖржкржирж╛рж░ ржлрж╕рж▓ рж▓рж┐ржЦрзБржи:",
        "crop_stage": "рзи. ржлрж╕рж▓рзЗрж░ ржкрж░рзНржпрж╛ржпрж╝ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:",
        "problem_desc": "рзй. рж╕ржорж╕рзНржпрж╛ ржмрж░рзНржгржирж╛ ржХрж░рзБржи (ржпрзЗржоржи, 'ржирж┐ржЪрзЗрж░ ржкрж╛рждрж╛ржпрж╝ рж╣рж▓рзБржж ржжрж╛ржЧ'):",
        "goal": "рзк. ржЖржкржирж╛рж░ ржкрзНрж░рж╛ржержорж┐ржХ рж▓ржХрзНрж╖рзНржп ржХрж┐?",
        "get_plan_button": "ржмрж┐рж╢рзЗрж╖ржЬрзНржЮ ржкрж░рж┐ржХрж▓рзНржкржирж╛ рждрзИрж░рж┐ ржХрж░рзБржи",
        "ai_spinner": "ЁЯдЦ ржХрзГрж╖рж┐ржирзЗржЯ ржПржЖржЗ ржЖржкржирж╛рж░ ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░ржЫрзЗ...",
        "expert_plan_header": "ржЖржкржирж╛рж░ ржХрж╛рж╕рзНржЯржо ржХрж░рзНржо ржкрж░рж┐ржХрж▓рзНржкржирж╛:",
        "listen_plan": "ржПржЗ ржкрж░рж┐ржХрж▓рзНржкржирж╛ржЯрж┐ рж╢рзБржирзБржи",
        "audio_spinner": "ржЕржбрж┐ржУ рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ...",
        "audio_error": "ржжрзБржГржЦрж┐ржд, ржЕржбрж┐ржУ рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред",
        "chatbot_header": "ЁЯТм ржжрзНрж░рзБржд ржЪрзНржпрж╛ржЯ",
        "chat_input_placeholder": "ржПржХржЯрж┐ ржжрзНрж░рзБржд ржкрзНрж░рж╢рзНржи ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░рзБржи...",
    },
    "ta": {
        "header": "роХро┐ро░рпБро╖ро┐рооро┐родрпНро░ро╛",
        "subheader": "роЗроирпНродро┐ропро╛ро╡ро┐ро▓рпН ро╕рпНрооро╛ро░рпНроЯрпН ро╡ро┐ро╡роЪро╛роп роорпБроЯро┐ро╡рпБроХро│рпБроХрпНроХрпБ роЙроЩрпНроХро│рпН AI-роЗропроЩрпНроХрпБроорпН роЙродро╡ро┐ропро╛ро│ро░рпН.",
        "bhashabuddy_header": "рокро╛ро╖ро╛рокроЯрпНроЯро┐",
        "choose_language": "роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:",
        "sidebar_info": "роорпБро┤рпБроорпИропро╛роХ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯ роЕройрпБрокро╡родрпНродро┐ро▒рпНроХрпБ роТро░рпБ роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П роиро┐рокрпБрогро░рпН роХрогрпНроЯро▒ро┐родро▓рпН",
        "tab_mandi": "ЁЯУИ роорогрпНроЯро┐ ро╡ро┐ро▓рпИроХро│рпН",
        "tab_health": "ЁЯМ┐ рокропро┐ро░рпН роЖро░рпЛроХрпНроХро┐ропроорпН",
        "tab_schemes": "ЁЯУЬ роЕро░роЪро╛роЩрпНроХ родро┐роЯрпНроЯроЩрпНроХро│рпН",
        "tab_recommendations": "ЁЯМН рокропро┐ро░рпН рокро░ро┐роирпНродрпБро░рпИроХро│рпН",
        "expert_header": "ЁЯза роиро┐рокрпБрогро░рпН роХрогрпНроЯро▒ро┐родро▓рпН рооро▒рпНро▒рпБроорпН роЙро▒рпНрокродрпНродро┐родрпНродро┐ро▒ройрпН родро┐роЯрпНроЯроорпН",
        "expert_desc": "роОроЩрпНроХро│рпН AI ро╡ро┐ро╡роЪро╛роп ро╡ро┐роЮрпНроЮро╛ройро┐ропро┐роЯрооро┐ро░рпБроирпНродрпБ ро╡ро┐ро░ро┐ро╡ро╛рой роЪрпЖропро▓рпН родро┐роЯрпНроЯродрпНродрпИрокрпН рокрпЖро▒ роЙроЩрпНроХро│рпН рокропро┐ро░рпН роиро┐ро▓рпИропрпИ ро╡ро┐ро╡ро░ро┐роХрпНроХро╡рпБроорпН.",
        "enter_crop": "1. роЙроЩрпНроХро│рпН рокропро┐ро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН:",
        "crop_stage": "2. рокропро┐ро░рпН роиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:",
        "problem_desc": "3. роЪро┐роХрпНроХро▓рпИ ро╡ро┐ро╡ро░ро┐роХрпНроХро╡рпБроорпН (роО.роХро╛., 'роХрпАро┤рпН роЗро▓рпИроХро│ро┐ро▓рпН роороЮрпНроЪро│рпН рокрпБро│рпНро│ро┐роХро│рпН'):",
        "goal": "4. роЙроЩрпНроХро│рпН роорпБродройрпНроорпИ роЗро▓роХрпНроХрпБ роОройрпНрой?",
        "get_plan_button": "роиро┐рокрпБрогро░рпН родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН",
        "ai_spinner": "ЁЯдЦ роХро┐ро░рпБро╖ро┐роирпЖроЯрпН AI роЙроЩрпНроХро│рпН роиро┐ро▓рпИропрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНроХро┐ро▒родрпБ...",
        "expert_plan_header": "роЙроЩрпНроХро│рпН родройро┐рокрпНрокропройрпН роЪрпЖропро▓рпН родро┐роЯрпНроЯроорпН:",
        "listen_plan": "роЗроирпНродродрпН родро┐роЯрпНроЯродрпНродрпИроХрпН роХрпЗроЯрпНроХро╡рпБроорпН",
        "audio_spinner": "роЖроЯро┐ропрпЛ роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ...",
        "audio_error": "рооройрпНройро┐роХрпНроХро╡рпБроорпН, роЖроЯро┐ропрпЛро╡рпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ.",
        "chatbot_header": "ЁЯТм ро╡ро┐ро░рпИро╡ро╛рой роЕро░роЯрпНроЯрпИ",
        "chat_input_placeholder": "роТро░рпБ ро╡ро┐ро░рпИро╡ро╛рой роХрпЗро│рпНро╡ро┐ропрпИроХрпН роХрпЗроЯрпНроХро╡рпБроорпН...",
    },
    "te": {
        "header": "р░Хр▒Гр░╖р░┐р░ор░┐р░др▒Нр░░",
        "subheader": "р░нр░╛р░░р░др░жр▒Зр░╢р░Вр░▓р▒Л р░╕р▒Нр░ор░╛р░░р▒Нр░Яр▒Н р░╡р▒Нр░пр░╡р░╕р░╛р░п р░ир░┐р░░р▒Нр░гр░пр░╛р░▓ р░Хр▒Лр░╕р░В р░ор▒А AI-р░Жр░зр░╛р░░р░┐р░д р░╕р░╣р░╛р░пр░Хр▒Бр░бр▒Б.",
        "bhashabuddy_header": "р░нр░╛р░╖р░╛р░мр░бр▒Нр░бр▒А",
        "choose_language": "р░нр░╛р░╖р░ир▒Б р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐:",
        "sidebar_info": "р░кр▒Вр░░р▒Нр░др░┐р░Чр░╛ р░Ер░ир▒Бр░╡р░жр░┐р░Вр░Ър░мр░бр░┐р░и р░Ер░ир▒Бр░нр░╡р░В р░Хр▒Лр░╕р░В р░Тр░Х р░нр░╛р░╖р░ир▒Б р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П р░ир░┐р░кр▒Бр░гр▒Бр░▓ р░ир░┐р░░р▒Нр░зр░╛р░░р░г",
        "tab_mandi": "ЁЯУИ р░ор░Вр░бр░┐ р░зр░░р░▓р▒Б",
        "tab_health": "ЁЯМ┐ р░кр░Вр░Я р░Жр░░р▒Лр░Чр▒Нр░пр░В",
        "tab_schemes": "ЁЯУЬ р░кр▒Нр░░р░нр▒Бр░др▒Нр░╡ р░кр░ер░Хр░╛р░▓р▒Б",
        "tab_recommendations": "ЁЯМН р░кр░Вр░Я р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Бр░▓р▒Б",
        "expert_header": "ЁЯза р░ир░┐р░кр▒Бр░гр▒Бр░▓ р░ир░┐р░░р▒Нр░зр░╛р░░р░г р░ор░░р░┐р░пр▒Б р░Йр░др▒Нр░кр░╛р░жр░Хр░д р░кр▒Нр░░р░гр░╛р░│р░┐р░Х",
        "expert_desc": "р░ор░╛ AI р░╡р▒Нр░пр░╡р░╕р░╛р░п р░╢р░╛р░╕р▒Нр░др▒Нр░░р░╡р▒Зр░др▒Нр░д р░ир▒Бр░Вр░бр░┐ р░╡р░┐р░╡р░░р░гр░╛р░др▒Нр░ор░Х р░Хр░╛р░░р▒Нр░пр░╛р░Ър░░р░г р░кр▒Нр░░р░гр░╛р░│р░┐р░Хр░ир▒Б р░кр▒Кр░Вр░жр░бр░╛р░ир░┐р░Хр░┐ р░ор▒А р░кр░Вр░Я р░кр░░р░┐р░╕р▒Нр░ер░┐р░др░┐р░ир░┐ р░╡р░┐р░╡р░░р░┐р░Вр░Ър░Вр░бр░┐.",
        "enter_crop": "1. р░ор▒А р░кр░Вр░Яр░ир▒Б р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐:",
        "crop_stage": "2. р░кр░Вр░Я р░жр░╢р░ир▒Б р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐:",
        "problem_desc": "3. р░╕р░ор░╕р▒Нр░пр░ир▒Б р░╡р░┐р░╡р░░р░┐р░Вр░Ър░Вр░бр░┐ (р░Йр░жр░╛., 'р░жр░┐р░Чр▒Бр░╡ р░Жр░Хр▒Бр░▓р░кр▒И р░кр░╕р▒Бр░кр▒Б р░ор░Ър▒Нр░Ър░▓р▒Б'):",
        "goal": "4. р░ор▒А р░кр▒Нр░░р░╛р░ер░ор░┐р░Х р░▓р░Хр▒Нр░╖р▒Нр░пр░В р░Пр░ор░┐р░Яр░┐?",
        "get_plan_button": "р░ир░┐р░кр▒Бр░гр▒Бр░▓ р░кр▒Нр░░р░гр░╛р░│р░┐р░Хр░ир▒Б р░░р▒Вр░кр▒Кр░Вр░жр░┐р░Вр░Ър░Вр░бр░┐",
        "ai_spinner": "ЁЯдЦ р░Хр▒Гр░╖р░┐роирпЖроЯрпН AI р░ор▒А р░кр░░р░┐р░╕р▒Нр░ер░┐р░др░┐р░ир░┐ р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░┐р░╕р▒Нр░др▒Лр░Вр░жр░┐...",
        "expert_plan_header": "р░ор▒А р░Хр░╕р▒Нр░Яр░ор▒Н р░Хр░╛р░░р▒Нр░пр░╛р░Ър░░р░г р░кр▒Нр░░р░гр░╛р░│р░┐р░Х:",
        "listen_plan": "р░И р░кр▒Нр░░р░гр░╛р░│р░┐р░Хр░ир▒Б р░╡р░┐р░ир░Вр░бр░┐",
        "audio_spinner": "р░Жр░бр░┐р░пр▒Л р░╕р▒Гр░╖р▒Нр░Яр░┐р░Вр░Ър░мр░бр▒Бр░др▒Лр░Вр░жр░┐...",
        "audio_error": "р░Хр▒Нр░╖р░ор░┐р░Вр░Ър░Вр░бр░┐, р░Жр░бр░┐р░пр▒Лр░ир▒Б р░╕р▒Гр░╖р▒Нр░Яр░┐р░Вр░Ър░бр░В р░╕р░╛р░зр▒Нр░пр░В р░Хр░╛р░▓р▒Зр░жр▒Б.",
        "chatbot_header": "ЁЯТм р░др▒Нр░╡р░░р░┐р░д р░Ър░╛р░Яр▒Н",
        "chat_input_placeholder": "р░Тр░Х р░╢р▒Ар░Шр▒Нр░░ р░кр▒Нр░░р░╢р▒Нр░и р░Ер░бр░Чр░Вр░бр░┐...",
    },
    "kn": {
        "header": "р▓Хр│Гр▓╖р▓┐р▓ор▓┐р▓др│Нр▓░",
        "subheader": "р▓нр▓╛р▓░р▓др▓жр▓▓р│Нр▓▓р▓┐ р▓╕р│Нр▓ор▓╛р▓░р│Нр▓Яр│Н р▓Хр│Гр▓╖р▓┐ р▓ир▓┐р▓░р│Нр▓зр▓╛р▓░р▓Чр▓│р▓┐р▓Чр▓╛р▓Чр▓┐ р▓ир▓┐р▓ор│Нр▓о AI-р▓Ър▓╛р▓▓р▓┐р▓д р▓╕р▓╣р▓╛р▓пр▓Х.",
        "bhashabuddy_header": "р▓нр▓╛р▓╖р▓╛р▓мр▓бр│Нр▓бр▓┐",
        "choose_language": "р▓нр▓╛р▓╖р│Жр▓пр▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐:",
        "sidebar_info": "р▓╕р▓Вр▓кр│Вр▓░р│Нр▓г р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓┐р▓д р▓Ер▓ир│Бр▓нр▓╡р▓Хр│Нр▓Хр▓╛р▓Чр▓┐ р▓Тр▓Вр▓жр│Б р▓нр▓╛р▓╖р│Жр▓пр▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐.",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П р▓др▓Ьр│Нр▓Юр▓░ р▓░р│Лр▓Чр▓ир▓┐р▓░р│Нр▓гр▓п",
        "tab_mandi": "ЁЯУИ р▓ор▓Вр▓бр▓┐ р▓мр│Жр▓▓р│Жр▓Чр▓│р│Б",
        "tab_health": "ЁЯМ┐ р▓мр│Жр▓│р│Ж р▓Жр▓░р│Лр▓Чр│Нр▓п",
        "tab_schemes": "ЁЯУЬ р▓╕р▓░р│Нр▓Хр▓╛р▓░р▓┐ р▓пр│Лр▓Ьр▓ир│Жр▓Чр▓│р│Б",
        "tab_recommendations": "ЁЯМН р▓мр│Жр▓│р│Ж р▓╢р▓┐р▓лр▓╛р▓░р▓╕р│Бр▓Чр▓│р│Б",
        "expert_header": "ЁЯза р▓др▓Ьр│Нр▓Юр▓░ р▓░р│Лр▓Чр▓ир▓┐р▓░р│Нр▓гр▓п р▓ор▓др│Нр▓др│Б р▓Йр▓др│Нр▓кр▓╛р▓жр▓Хр▓др│Ж р▓пр│Лр▓Ьр▓ир│Ж",
        "expert_desc": "р▓ир▓ор│Нр▓о AI р▓Хр│Гр▓╖р▓┐ р▓╡р▓┐р▓Ьр│Нр▓Юр▓╛р▓ир▓┐р▓пр▓┐р▓Вр▓ж р▓╡р▓┐р▓╡р▓░р▓╡р▓╛р▓ж р▓Хр│Нр▓░р▓┐р▓пр▓╛ р▓пр│Лр▓Ьр▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓кр▓бр│Жр▓пр▓▓р│Б р▓ир▓┐р▓ор│Нр▓о р▓мр│Жр▓│р│Ж р▓кр▓░р▓┐р▓╕р│Нр▓ер▓┐р▓др▓┐р▓пр▓ир│Нр▓ир│Б р▓╡р▓┐р▓╡р▓░р▓┐р▓╕р▓┐.",
        "enter_crop": "1. р▓ир▓┐р▓ор│Нр▓о р▓мр│Жр▓│р│Жр▓пр▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐:",
        "crop_stage": "2. р▓мр│Жр▓│р│Ж р▓╣р▓Вр▓др▓╡р▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐:",
        "problem_desc": "3. р▓╕р▓ор▓╕р│Нр▓пр│Жр▓пр▓ир│Нр▓ир│Б р▓╡р▓┐р▓╡р▓░р▓┐р▓╕р▓┐ (р▓Йр▓жр▓╛., 'р▓Хр│Жр▓│р▓Чр▓┐р▓и р▓Ор▓▓р│Жр▓Чр▓│ р▓ор│Зр▓▓р│Ж р▓╣р▓│р▓жр▓┐ р▓Ър│Бр▓Хр│Нр▓Хр│Жр▓Чр▓│р│Б'):",
        "goal": "4. р▓ир▓┐р▓ор│Нр▓о р▓кр│Нр▓░р▓╛р▓ер▓ор▓┐р▓Х р▓Чр│Бр▓░р▓┐ р▓Пр▓ир│Б?",
        "get_plan_button": "р▓др▓Ьр│Нр▓Юр▓░ р▓пр│Лр▓Ьр▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓░р▓Ър▓┐р▓╕р▓┐",
        "ai_spinner": "ЁЯдЦ р▓Хр│Гр▓╖р▓┐р▓ир│Жр▓Яр│Н AI р▓ир▓┐р▓ор│Нр▓о р▓кр▓░р▓┐р▓╕р│Нр▓ер▓┐р▓др▓┐р▓пр▓ир│Нр▓ир│Б р▓╡р▓┐р▓╢р│Нр▓▓р│Зр▓╖р▓┐р▓╕р│Бр▓др│Нр▓др▓┐р▓жр│Ж...",
        "expert_plan_header": "р▓ир▓┐р▓ор│Нр▓о р▓Хр▓╕р│Нр▓Яр▓ор│Н р▓Хр│Нр▓░р▓┐р▓пр▓╛ р▓пр│Лр▓Ьр▓ир│Ж:",
        "listen_plan": "р▓И р▓пр│Лр▓Ьр▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓Хр│Зр▓│р▓┐",
        "audio_spinner": "р▓Жр▓бр▓┐р▓пр│Л р▓░р▓Ър▓┐р▓╕р▓▓р▓╛р▓Чр│Бр▓др│Нр▓др▓┐р▓жр│Ж...",
        "audio_error": "р▓Хр│Нр▓╖р▓ор▓┐р▓╕р▓┐, р▓Жр▓бр▓┐р▓пр│Л р▓░р▓Ър▓┐р▓╕р▓▓р│Б р▓╕р▓╛р▓зр│Нр▓пр▓╡р▓╛р▓Чр▓▓р▓┐р▓▓р│Нр▓▓.",
        "chatbot_header": "ЁЯТм р▓др│Нр▓╡р▓░р▓┐р▓д р▓Ър▓╛р▓Яр│Н",
        "chat_input_placeholder": "р▓Тр▓Вр▓жр│Б р▓др│Нр▓╡р▓░р▓┐р▓д р▓кр│Нр▓░р▓╢р│Нр▓ир│Ж р▓Хр│Зр▓│р▓┐...",
    },
    "pa": {
        "header": "риХрйНри░ри┐ри╕ри╝рйАриори┐рй▒ридри░",
        "subheader": "ринри╛ри░рид ри╡ри┐рй▒риЪ ри╕риори╛ри░риЯ риЦрйЗридрйА рижрйЗ рилрйИри╕ри▓ри┐риЖриВ ри▓риИ ридрйБри╣ри╛рибри╛ AI-ри╕рй░риЪри╛ри▓ри┐рид ри╕ри╣ри╛риЗриХред",
        "bhashabuddy_header": "ринри╛ри╕ри╝ри╛римрй▒рибрйА",
        "choose_language": "ринри╛ри╕ри╝ри╛ риЪрйБригрйЛ:",
        "sidebar_info": "рикрйВри░рйА ридри░рйНри╣ри╛риВ риЕриирйБри╡ри╛риж риХрйАридрйЗ риЕриирйБринри╡ ри▓риИ риЗрй▒риХ ринри╛ри╕ри╝ри╛ риЪрйБригрйЛред",
        "tab_expert_diagnosis": "ЁЯСйтАНтЪХя╕П риори╛ри╣ри░ риири┐рижри╛рии",
        "tab_mandi": "ЁЯУИ риорй░рибрйА рижрйАриЖриВ риХрйАриоридри╛риВ",
        "tab_health": "ЁЯМ┐ рилри╕ри▓ рижрйА ри╕ри┐ри╣рид",
        "tab_schemes": "ЁЯУЬ ри╕ри░риХри╛ри░рйА рипрйЛриЬриири╛ри╡ри╛риВ",
        "tab_recommendations": "ЁЯМН рилри╕ри▓ рижрйАриЖриВ ри╕ри┐рилри╛ри░ри╕ри╝ри╛риВ",
        "expert_header": "ЁЯза риори╛ри╣ри░ риири┐рижри╛рии риЕридрйЗ риЙридрикри╛рижриХридри╛ рипрйЛриЬриири╛",
        "expert_desc": "ри╕ри╛рибрйЗ AI риЦрйЗридрйА ри╡ри┐риЧри┐риЖриирйА ридрйЛриВ ри╡ри┐ри╕ридрйНри░ри┐рид риХри╛ри░риЬ рипрйЛриЬриири╛ рикрйНри░ри╛рикрид риХри░рии ри▓риИ риЖрикригрйА рилри╕ри▓ рижрйА ри╕риери┐ридрйА рижри╛ ри╡ри░ригрии риХри░рйЛред",
        "enter_crop": "1. риЖрикригрйА рилри╕ри▓ рижри╛риЦри▓ риХри░рйЛ:",
        "crop_stage": "2. рилри╕ри▓ рижри╛ рикрйЬри╛риЕ риЪрйБригрйЛ:",
        "problem_desc": "3. ри╕риорй▒ри╕ри┐риЖ рижри╛ ри╡ри░ригрии риХри░рйЛ (риЬри┐ри╡рйЗриВ, 'ри╣рйЗриари▓рйЗ рикрй▒ридри┐риЖриВ 'ридрйЗ рикрйАри▓рйЗ ризрй▒римрйЗ'):",
        "goal": "4. ридрйБри╣ри╛рибри╛ риорйБрй▒риЦ риЯрйАриЪри╛ риХрйА ри╣рйИ?",
        "get_plan_button": "риори╛ри╣ри░ рипрйЛриЬриири╛ римригри╛риУ",
        "ai_spinner": "ЁЯдЦ риХрйНри░ри┐ри╕ри╝рйАриирйИрй▒риЯ AI ридрйБри╣ри╛рибрйА ри╕риери┐ридрйА рижри╛ ри╡ри┐ри╕ри╝ри▓рйЗри╕ри╝риг риХри░ ри░ри┐ри╣ри╛ ри╣рйИ...",
        "expert_plan_header": "ридрйБри╣ри╛рибрйА риХри╕риЯрио риХри╛ри░риЬ рипрйЛриЬриири╛:",
        "listen_plan": "риЗри╕ рипрйЛриЬриири╛ риирйВрй░ ри╕рйБригрйЛ",
        "audio_spinner": "риЖрибрйАриУ римригри╛риЗриЖ риЬри╛ ри░ри┐ри╣ри╛ ри╣рйИ...",
        "audio_error": "риори╛рил риХри░риири╛, риЖрибрйАриУ риири╣рйАриВ римригри╛риЗриЖ риЬри╛ ри╕риХри┐риЖред",
        "chatbot_header": "я┐╜ ридрйБри░рй░рид риЧрй▒ри▓римри╛рид",
        "chat_input_placeholder": "риЗрй▒риХ ридрйБри░рй░рид ри╕ри╡ри╛ри▓ рикрйБрй▒риЫрйЛ...",
    }
    
}

# --- UI Components ---

with st.sidebar:
    st.header("BhashaBuddy (рднрд╛рд╖рд╛рдмрдбреА)")
    # --- EXPANDED LANGUAGE OPTIONS ---
    language_options = {
        "English": "en", "рд╣рд┐рдиреНрджреА (Hindi)": "hi", "ржмрж╛ржВрж▓рж╛ (Bengali)": "bn",
        "р░др▒Жр░▓р▒Бр░Чр▒Б (Telugu)": "te", "рдорд░рд╛рдареА (Marathi)": "mr", "родрооро┐ро┤рпН (Tamil)": "ta",
        "ркЧрлБркЬрк░рк╛ркдрлА (Gujarati)": "gu", "р▓Хр▓ир│Нр▓ир▓б (Kannada)": "kn", "рикрй░риЬри╛римрйА (Punjabi)": "pa"
    }
    selected_language_name = st.selectbox("Choose Language:", list(language_options.keys()))
    selected_language_code = language_options.get(selected_language_name, "en")
    t = translations.get(selected_language_code, translations["en"])
    st.markdown("---")
    st.info(t["sidebar_info"])

st.title(f"ЁЯМ╛ {t['header']}")
st.markdown(f"#### {t['subheader']}")

# --- Main Content Area using Tabs ---
tab1, tab2, tab3, tab4, tab5 = st.tabs([t["tab_expert_diagnosis"], t["tab_mandi"], t["tab_health"], t["tab_schemes"], t["tab_recommendations"]])

# --- Tab 1: Expert Diagnosis ---
with tab1:
    col1, col2 = st.columns([2, 1])
    with col1:
        with st.container(border=True):
            st.header(t["expert_header"])
            st.markdown(t["expert_desc"])

            expert_crop = st.text_input(t["enter_crop"], "Tomato")
            crop_stages = ["Sowing", "Vegetative Growth", "Flowering", "Harvesting"]
            expert_stage = st.selectbox(t["crop_stage"], crop_stages)
            expert_problem = st.text_area(t["problem_desc"], "Yellow spots with brown edges on lower leaves.")
            goals = ["Increase Yield", "Improve Quality", "Reduce Costs", "Control Pests"]
            expert_goal = st.selectbox(t["goal"], goals)

            if st.button(t["get_plan_button"], use_container_width=True, type="primary"):
                api_endpoint = f"{BACKEND_URL}/api/v1/expert_advice"
                payload = {
                    "crop": expert_crop, "crop_stage": expert_stage,
                    "problem_description": expert_problem, "goal": expert_goal,
                    "lang": selected_language_code
                }
                try:
                    with st.spinner(t["ai_spinner"]):
                        response = requests.post(api_endpoint, json=payload, timeout=60)
                        response.raise_for_status()
                        data = response.json()
                        st.subheader(t["expert_plan_header"])
                        expert_plan_text = data.get("expert_plan", "No plan generated.")
                        st.markdown(expert_plan_text)

                        # --- RE-INTEGRATED AUDIO ADVICE ---
                        if expert_plan_text:
                            st.markdown("---")
                            st.subheader(t["listen_plan"])
                            with st.spinner(t["audio_spinner"]):
                                tts_params = {"text": expert_plan_text, "lang": selected_language_code}
                                audio_response = requests.get(f"{BACKEND_URL}/api/v1/generate_audio", params=tts_params)
                                if audio_response.status_code == 200:
                                    st.audio(BytesIO(audio_response.content), format='audio/mpeg')
                                else:
                                    st.error(t["audio_error"])

                except requests.exceptions.RequestException as e:
                    st.error(f"Connection Error: {e}")
    
    with col2:
        with st.container(border=True):
            st.header(t["chatbot_header"])

            # Initialize chat history in session state
            if "messages" not in st.session_state:
                st.session_state.messages = []

            # Display prior chat messages
            for message in st.session_state.messages:
                with st.chat_message(message["role"]):
                    st.markdown(message["content"])

            if prompt := st.chat_input(t["chat_input_placeholder"]):
                # Add user message to history and display it
                st.session_state.messages.append({"role": "user", "content": prompt})
                with st.chat_message("user"):
                    st.markdown(prompt)

                # Get assistant response and display it
                with st.chat_message("assistant"):
                    history_for_api = [{"user": msg["content"]} if msg["role"] == "user" else {"assistant": msg["content"]} for msg in st.session_state.messages[:-1]]
                    response = requests.post(f"{BACKEND_URL}/api/v1/chatbot", json={"user_message": prompt, "language": selected_language_code, "history": history_for_api})
                    assistant_response = response.json().get("response", "...")
                    st.markdown(assistant_response)
                    st.session_state.messages.append({"role": "assistant", "content": assistant_response})
